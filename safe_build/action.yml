name: 'Build Package'
description: 'build a package'

inputs:
  compiler:
    description: 'which compiler'
    required: true
    default: gcc-12

runs:
  using: "composite"
  steps:
    - name: bootstrap
      shell: bash
      run: sh bootstrap.sh

    - name: configure
      id: configure
      shell: bash
      env:
        CXX: ${{ inputs.compiler }}
      run: ./configure
      continue-on-error: true
    - name: get configure_status
      uses: ./.github/actions/get_status
      with:
        the-step: configure
        outcome: ${{ steps.configure.outcome }}
    - name: config.log
      shell: bash
      if: ${{ env.action_status == 'install' }}
      run: cat config.log
    - name: make
      id: make
      shell: bash
      if: ${{ env.action_status == '' }}
      env:
        CXX: ${{ inputs.compiler }}
      run: make
      continue-on-error: true
    - name: get make_status
      uses: ./.github/actions/get_status
      with:
        the-step: make
        outcome: ${{ steps.make.outcome }}
    - name: install
      id: install
      shell: bash
      if: ${{ env.action_status == '' }}
      env:
        CXX: ${{ inputs.compiler }}
      run: sudo make install
      continue-on-error: true
    - name: get install_status
      uses: ./.github/actions/get_status
      with:
        the-step: install
        outcome: ${{ steps.install.outcome }}
    - name: make check
      id: check
      shell: bash
      if: ${{ env.action_status == '' }}
      env:
        CXX: ${{ inputs.compiler }}
        LD_LIBRARY_PATH: $LD_LIBRARY_PATH:/usr/local/lib
      run: make check
      continue-on-error: true
    - name: get check_status
      uses: ./.github/actions/get_status
      with:
        the-step: check
        outcome: ${{ steps.check.outcome }}
    - name: show log
      shell: bash
      if: ${{ env.action_status == 'check' }}
      run: cat src/test-suite.log
      continue-on-error: true
